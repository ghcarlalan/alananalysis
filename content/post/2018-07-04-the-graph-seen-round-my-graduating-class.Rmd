---
title: The Graph Seen 'Round My Graduating Class
author: Alan Carlson
date: '2018-07-04'
slug: the-graph-seen-round-my-graduating-class
categories: []
tags: []
---

```{r setup, include=FALSE}
library(dplyr)
library(knitr)
library(ggplot2)
library(lubridate)
library(reshape2)
library(blogdown)
library(htmltools)
library(gridExtra)

theme_set(theme_bw() + theme(text = element_text(size=12)))

knit_hooks$set(htmlcap = function(before, options, envir) {
  if(!before) {
    paste('<p style="text-align:center "><i>',options$htmlcap,"</i></p>",sep="")
    }
    })
```

It's been 5 years since I graduated high school. There were about 1,200 students in total when I left, and I graduated with 286 other young adults eager to do something with our lives. If facebook is any indicator though, that *something* was to get married and/or have kids as soon as possible. It's eastern Idaho; what can you expect?

```{r,echo=FALSE,out.width='50%',htmlcap="So many Mormons is what you can expect",fig.align='center'}
knitr::include_graphics("/post/2018-07-04-the-graph-seen-round-my-graduating-class_files/0001people.jpeg")
```

Naturally, this can slightly (read: really) bum you out if you think you're in the minority of not being one of those people who have found their life partner or have had their mini me before 23. To combat this feeling, [this tweet](https://twitter.com/KeelyeShaye/status/1001511141711974400) was shared in a group chat with my 3 best friends from said high school. Jokes about getting shitfaced aside, I was actually curious to find out just how many people I graduated with that I would be taking shots for (and if you're a part of HHS Class of 2013, prepare for several bottles of alcohol).

```{r,echo=FALSE,warning=FALSE,message=FALSE,fig.height=3}
#data load
dt <- read.csv("C://Users/Alan/OneDrive/Documents/OneDrive/hhs.csv",stringsAsFactors = FALSE)
names(dt) <- c("name","pregnant","engaged","shots","gender")

#convert gender to label
dt$gender <- ifelse(dt$gender == 1, "Female","Male")
dt$gender <- factor(dt$gender, levels = c("Male","Female"))
dt$shots <- dt$pregnant + dt$engaged

#aggregate set
agg <- melt(dt[,c(1:3)],id="name")

agg <- agg %>%
  group_by(variable,value) %>%
  summarise(n = n()) %>%
  mutate(percent = n/sum(n))

#plot
ggplot(agg,aes(variable,percent,fill=as.character(value))) + 
  geom_bar(stat = 'identity',position = 'stack',color="white",size=.25) +
  geom_text(aes(label = paste(round(agg$percent,3)*100,"%",sep = '')),
            position = position_stack(vjust=.5),
            fontface = "bold",
            color="white") +
  coord_flip(ylim = c(0,1)) +
  scale_x_discrete(labels = c("At least\nPregnant","At least\nEngaged")) +
  scale_y_continuous(expand = c(0,0)) +
  scale_fill_manual('',labels=c("No","Yes"),values = c("black","#D90B0B")) +
  labs(x=NULL,
       y=NULL,
       title="Percent of Class by Status",
       subtitle = paste("(Out of",nrow(dt),"total students)"),
       caption = "Generated by Alan Carlson") +
  guides(fill = guide_legend(reverse = TRUE)) +
  theme(panel.grid = element_blank(),
        axis.text.x = element_blank(),
        axis.ticks = element_blank(),
        legend.position = c(.9,1.075),
        legend.background = element_blank(),
        legend.direction = 'horizontal',
        legend.text = element_text(face='bold'))
```

After facebook stalking everyone I could find, I found that almost 40% of my class has a ring on their finger, while just over 10% are now familiar with the diaper market. Which I suppose makes sense given current trends on the subjects; it takes longer for marriage to come to fruition, and even longer for that marriage (or any relationship not involving marriage) to bear uh.. fruit as it were.

What is interesting is that 4 couples that are married are *in this same class.* That's right! Not only are they high school sweethearts, they are high school graduating class sweethearts!

```{r,echo=FALSE,out.width='50%',htmlcap="Surely you can propose with something other than our class ring, Tim",fig.align='center'}
knitr::include_graphics("/post/2018-07-04-the-graph-seen-round-my-graduating-class_files/0002ring.jpeg")
```

I've also taken the liberty of separating these stats by gender, because why not?

```{r,echo=FALSE,warning=FALSE,message=FALSE,fig.height=6}
#gender set
gen <- melt(dt[,c(1:3,5)],id=c("name","gender"))

gen <- gen %>%
  group_by(gender,variable,value) %>%
  summarise(n=n()) %>%
  mutate(percent = n/sum(n))

#agg/gen set
agg.gen <- dt %>%
  group_by(gender) %>%
  summarise(n=n()) %>%
  mutate(percent = n/sum(n))

#plot
grid.arrange(
ggplot(agg.gen,aes("Gender",percent,fill=gender)) + 
  geom_bar(stat = 'identity',position = position_stack(reverse = TRUE),color="white",size=.25) +
  geom_text(aes(label = paste(round(agg.gen$percent,3)*100,"%",sep = '')),
            position = position_stack(vjust=.5,reverse = TRUE),
            fontface = "bold",
            color="white") +
  coord_flip(ylim = c(0,1)) +
  scale_y_continuous(expand = c(0,0)) +
  scale_fill_manual('',labels=c("Male","Female"),values = rev(c("black","#D90B0B"))) +
  labs(x=NULL,
       y=NULL,
       title="Percent of Class by Gender",
       subtitle = paste("(Out of",nrow(dt),"total students)")) +
  guides(fill = guide_legend(reverse = FALSE)) +
  theme(panel.grid = element_blank(),
        axis.text.x = element_blank(),
        axis.ticks = element_blank(),
        legend.position = c(.85,1.15),
        legend.direction = 'horizontal',
        legend.text = element_text(face='bold'),
        legend.background = element_rect(fill = NA))
,
ggplot(gen,aes(variable,percent,fill=as.character(value))) + 
  geom_bar(stat = 'identity',position = 'stack',color="white",size=.25) +
  geom_text(data=gen %>% filter(percent >= .1),
            aes(label = paste(round(percent,3)*100,"%",sep = '')),
            position = position_stack(vjust=.5),
            fontface = "bold",
            color="white") +
  facet_grid(~ gender) +
  coord_flip(ylim = c(0,1)) +
  scale_x_discrete(labels = c("At least\nPregnant","At least\nEngaged")) +
  scale_y_continuous(expand = c(0,0)) +
  scale_fill_manual('',labels=c("No","Yes"),values = c("black","#D90B0B")) +
  labs(x=NULL,
       y=NULL,
       title="Percent of Class by Status & Gender",
       subtitle = paste("(Out of",
                        sum(gen$n[gen$gender == "Male"])/2,
                        "male students &",
                        sum(gen$n[gen$gender == "Female"])/2,
                        "female students)"),
       caption = "Generated by Alan Carlson") +
  guides(fill = guide_legend(reverse = TRUE)) +
  theme(panel.grid = element_blank(),
        axis.text.x = element_blank(),
        axis.ticks = element_blank(),
        legend.position = c(.9,1.175),
        legend.direction = 'horizontal',
        legend.text = element_text(face='bold'))
,nrow = 2
,heights = c(1,1.75)
)
```

Now here is where we can get some meaning. 1 in 3 men are at least engaged right now. Which is hilariously accurate since 1 of my 3 friends in my afforementioned group chat is married. On the flip side, over 2 in 5 women are at least engaged, which is especially interesting after you notice that the percent in each gender is basically the same. Women are more likely to be engaged or married and are twice as likely to be expecting or have a kid in their family.

These stats might be sobering, but that can quickly be fixed by equating these graphs to a few drinks! How many you ask?

```{r,echo=FALSE,warning=FALSE,message=FALSE,fig.height=3,fig.width=3}
ggplot(dt,aes(sum(dt$shots),1)) +
  geom_point(aes(size=sum(dt$shots)),color="black",shape=21,fill="#D90B0B",stroke=6) +
  geom_text(aes(label=sum(dt$shots)),size=20,color="white",fontface="bold") +
  geom_text(aes(label="Drinks"),vjust=5.75,size=8.5,fontface="bold") +
  scale_size_area(max_size = 70,guide = 'none') +
  theme_void()
```

For context, that's just **over a gallon** of alcohol if you're going by shots, and it would take almost **6 full days** for your body to process at 1 oz/hour. To tackle this in a world where alcohol poisoning exists, however, I'll simply have an extra drink for the next several months instead of pouring one out for everyone that made the cut. Who knows? By the time I finish, I'll probably have more drinks to catch up on.

(I would also like to note that I in no way look down on anyone who decides to get married or have a kid this early in life. My parents did, I suppose. And while I don't necessarily understand how you *could* figure that part of your life out for sure before 23, I'm sure it's a nice feeling knowing that you found someone to be with whether that be your spouse, significant other, child, or even pet for those that have them. For those of us that have none of those things? You're more than welcome to have a drink with me.) 